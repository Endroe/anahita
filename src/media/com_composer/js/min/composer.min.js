!function(t,e,o){"use strict";t.widget("anahita.composerform",{options:{stories:"#an-stories",form:".composer-form"},_create:function(){var e=t(this.element);if("multipart/form-data"===e.attr("enctype")){var o=new FormData(e[0]);o.append("composed",!0),o.append("format","raw"),this._on(e,{submit:function(n){n.stopPropagation(),n.preventDefault(),t.each(e.serializeArray(),function(t,e){o.append(e.name,e.value)}),t.each(e.find(":file")[0].files,function(t,e){o.append("file",e)}),t.ajax({url:e.attr("action"),processData:!1,contentType:!1,cache:!1,data:o,type:"POST",success:function(e){t(this.element).trigger("reset"),t(this.options.stories).prepend(t(e).fadeIn("slow"))}.bind(this)})}})}else this._on(e,{submit:function(o){o.stopPropagation(),o.preventDefault(),t.ajax({url:e.attr("action"),data:e.serialize()+"&composed=1",cache:!1,type:"POST",success:function(e){t(this.element).trigger("reset"),t(this.options.stories).prepend(t(e).fadeIn("slow"))}.bind(this)})}})}}),t.widget("anahita.composer",{options:{composerTab:".tab-content-item",formPlaceholder:"a.form-placeholder",composerForm:".composer-form",composerMenu:"#composer-menu li",composerMenuTitle:".composer-button-title"},_create:function(){this.firstTime=!0,this.currentTabIndex=0,this.tabs=this.element.find(this.options.composerTab);var e=this.options.formPlaceholder;this.tabs.each(function(o,n){t(n).data("placeholder",t(n).find(e))}),this._on(t(this.options.composerMenu),{click:function(e){e.preventDefault();var o=t(e.delegateTarget);t(this.options.composerMenuTitle).text(o.find("a").attr("title")),this.selectTab(o.index())}}),this._on(t(this.options.composerTab),{elem:t(this.options.formPlaceholder),click:function(e){e.stopPropagation(),this.showTabContent(t(e.delegateTarget).index())}}),this._on({elem:t(this),clickoutside:function(){this.hideTabContent(this.currentTabIndex)}}),this.selectTab(this.currentTabIndex)},selectTab:function(e){var o=this;t(this.tabs[this.currentTabIndex]).hide(),this.currentTabIndex=e;var n=t(this.tabs[this.currentTabIndex]);return n.data("content")||t.ajax({method:"get",url:n.data("url"),beforeSend:function(){o.firstTime||o.element.fadeTo("fast",.8).addClass("uiActivityIndicator")},success:function(e){n.append(e),t(e).find("form.composer-form").composerform(),n.data("content",n.find(o.options.composerForm)),o.firstTime&&(o.firstTime=!1,o.hideTabContent(o.currentTabIndex))},complete:function(){o.element.fadeTo("fast",1).removeClass("uiActivityIndicator")}}),this.firstTime||this.showTabContent(this.currentTabIndex),n.fadeIn(),this},showTabContent:function(e){var o=t(this.tabs[e]);t(o.data("placeholder")).hide(),t(o.data("content")).fadeIn()},hideTabContent:function(e){var o=t(this.tabs[e]);t(o.data("content")).hide(),t(o.data("placeholder")).fadeIn()}});var n=t("[data-behavior='Composer']").composer(),i=t("ul.streams");i.length&&i.on("click","li",function(){"stories"==t(this).data("stream")?n.fadeIn():n.fadeOut()}),t(o).ajaxSuccess(function(){var e=t("a.connect-link");e.length&&t(e).tooltip({placement:"top",animation:!0,trigger:"hover"})})}(jQuery,window,document);