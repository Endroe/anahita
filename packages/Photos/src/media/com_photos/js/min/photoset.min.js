!function(t){"use strict";t.widget("anahita.photoSetAssignment",{_create:function(){var e=this;this.photoId=this.element.data("photo"),this.url=this.element.data("url"),this._on('[data-action="OpenSetSelector"]',{click:function(t){t.preventDefault(),e._open(t.target.href)}}),this._on(this.element,{'click [data-action="CloseSetSelector"]':function(t){t.preventDefault(),e._close(e.url)}});var n=this.element.find("form");this._on(this.element,{elem:n,submit:function(n){n.preventDefault(),t.ajax({method:"post",url:t(n.target).attr("action"),data:t(n.target).serialize(),success:function(t){e.element.find(".an-entities").prepend(t)}})}}),this._on(this.element,{'click [data-action="addphoto"], [data-action="removephoto"]':function(e){e.preventDefault(),this._changeAssignment(t(e.currentTarget))}})},_open:function(e){var n=this;t.ajax({method:"get",url:e+"&photo_id"+this.photoId,beforeSend:function(){n.element.slideUp()},success:function(t){n.element.html(t)},complete:function(){n.element.slideDown()}})},_close:function(e){var n=this;t.ajax({method:"get",url:e+"&photo_id="+this.photoId,beforeSend:function(){n.element.slideUp()},success:function(t){n.element.html(t)},complete:function(){n.element.slideDown()}})},_changeAssignment:function(e){var n=e.data("action");t.ajax({method:"post",url:e.data("url"),data:{photo_id:this.photoId,action:n},beforeSend:function(){e.fadeTo("fast",.7).addClass("uiActivityIndicator")},success:function(){e.fadeTo("fast",1).removeClass("uiActivityIndicator"),"addphoto"==n?(e.data("data-action","removephoto"),e.addClass("an-highlight")):(e.data("data-action","addphoto"),e.removeClass("an-highlight"))}})}}),t("#sets-wrapper").photoSetAssignment()}(jQuery,window);